import numpy as np
import pandas as pd
pd.options.plotting.backend = "plotly"
import matplotlib.pyplot as plt
import sqlite3

conn = sqlite3.connect(':memory:')

c = conn.cursor()

c.execute("""CREATE TABLE coords (
        x_coords real,
        y_coords real
        )""")

def get_x_coords():
    c.execute("SELECT x_coords FROM coords")
    return c.fetchall()

def get_y_coords():
    c.execute("SELECT y_coords FROM coords")
    return c.fetchall()

plots = [
    (0.8050656477339626, -555.9261091297377),
    (2.21379664414682, -469.03208566723805),
    (2.9341616519249034, -435.55556041550153),
    (3.1577679241223833, -463.92417096579027),
    (3.442302471482197, -328.2118051758269),
    (3.525620194118604, -320.93586987740673),
    (4.469520865787336, -146.00952876534217),
    (4.515195057558348, -286.816096868934),
    (4.701730329930101, -318.31261292355947),
    (4.905189501927184, -139.63474709351027),
    (5.075330816529264, -64.5352644227873),
    (5.563694733617873, 7.999212998921166),
    (5.614385992779825, -57.01610330289216),
    (6.172530156920189, -128.81178949931657),
    (6.783642473026676, 240.10705373110684),
    (7.803208869063158, 594.3218333346795),
    (8.039115843407387, 443.0636898413863),
    (8.077992875232795, 561.9810860633453),
    (8.465543530723274, 828.9676347566381),
    (8.948074076043802, 863.6137409303999)
]
c.executemany("INSERT INTO coords VALUES (?, ?)", plots)

conn.commit()

x = np.array([0.8050656477339626, 2.21379664414682, 2.9341616519249034, 3.1577679241223833, 3.442302471482197, 3.525620194118604, 4.469520865787336, 4.515195057558348, 4.701730329930101, 4.905189501927184, 5.075330816529264, 5.563694733617873, 5.614385992779825, 6.172530156920189, 6.783642473026676, 7.803208869063158, 8.039115843407387, 8.077992875232795, 8.465543530723274, 8.948074076043802])
y = np.array([-555.9261091297377, -469.03208566723805, -435.55556041550153, -463.92417096579027, -328.2118051758269, -320.93586987740673, -146.00952876534217, -286.816096868934, -318.31261292355947, -139.63474709351027, -64.5352644227873, 7.999212998921166, -57.01610330289216, -128.81178949931657, 240.10705373110684, 594.3218333346795, 443.0636898413863, 561.9810860633453, 828.9676347566381, 863.6137409303999])

coeff = np.polyfit(x, y, 3)
mymodel = np.poly1d(coeff)
rootsp = mymodel.r
myline = np.linspace(0.8, 9, 40)

plt.scatter(x, y)
fig = plt.plot(myline, mymodel(myline))
plt.savefig('static/figure.png')

conn.close()